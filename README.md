# Приложение «Банк»

Микросервисное приложение «Банк» написано с использованием Spring Boot и паттернов микросервисной архитектуры.

Список микросервисов:

- Фронт (**front**)   
  веб-приложение с клиентским HTML-интерфейсом
- Сервис аккаунтов (**accounts**)   
  хранит информацию о зарегистрированных аккаунтах и счетах в каждом из них
- Сервис обналичивания денег (**cash**)    
  осуществляет пополнение счёта или снятие денег со счёта
- Сервис перевода денег между счетами (**transfer**)   
  осуществляет перевод денег между счетами одного пользователя и между счетами разных пользователей
- Сервис конвертации валют (**exchange**)   
  хранит информацию о конвертации валюты при её покупке/продаже
- Сервис генерации курсов валют (**exchange-generator**)    
  каждую секунду по расписанию генерирует курсы валют
- Сервис блокировки подозрительных операций (**blocker**)    
  отслеживает подозрительные операции
- Сервис уведомлений (**notifications**)   
  отправляет уведомления на email
- Прокси сервис OAuth2  (**oauth2-proxy**)   
  сервис добавляет в запрос от ингресса к микросервису Bearer токен, который предварительно получает в Keycloak

Сервисы взаимодействуют через Ingress, который авторизуются для выполнения запросов в другие сервисы через OAuth 2.0
(**Keycloak**). В папке bank-app зонтичный Helm-чарт для деплоя приложения в kubernetes

## Использование

На устройстве должен быть установлены и запущены Docker и Kubernetes. В папке jenkins нужно создать .env файл
(заполнить его по примеру .env.example). И добавить хосты в /etc/hosts:

```bash
127.0.0.1 bank-app-keycloak
127.0.0.1 main.test.local
127.0.0.1 main.prod.local
```

После этого выполните команду;

```sh
cd jenkins && docker compose up -d
```

Интерфейс jenkins будет доступен по адресу:

```
http://localhost:8080
```

CI/CD-процесс должен запуститься автоматически, деплой в prod окружение нужно подтвердить.
После того как приложение поднимется, нужно зайти в keycloak (http://bank-app-keycloak) и импортировать realm, файл лежит тут:

```
bank-app/realm-import.json
```

После чего приложение будет готово и доступно по адресу:

```
http://localhost/register
```